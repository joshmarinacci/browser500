<!DOCTYPE html>
<html lang="en">
<head>
    <title>cool example</title>
</head>
<body>
<canvas width='400' height='200'></canvas>
<script type='module'>
    import {layout} from './layout'
    import {render} from './render'
    import {parse_html} from './html'
    import {extract_styles, parse_styles} from './style'
    import {BPoint, BSize} from './common'
    import {find_element} from './render'

    let html1 = `
  <html>
    <style type="text/css">
        html {
            border: 2px solid #727272;
        }
        body {
            background-color: #e8e8e8;
        }
        p {
            background-color: white;
            text-align: right;
        }
        b {
            font-weight: bold;
        }
        i {
            font-style: italic;
        }
        b,i {
            color: red;
        }
        h2 {
            text-align: center;
        }
    </style>
      <body>
      <h1>Header one</h1>
      <p>Greetings <b>Earthling</b>. I have found a
       solution to <i>your world's</i> energy problems. I am going to
       <a href="https://screenrant.com/looney-tunes-funniest-ways-marvin-martian-tried-blow-up-earth/">blow
       it up</a>.
       </p>
       <h2>header two</h2>
      <p>hi there</p>
      <ul>
        <LI>item one</LI>
        <li>item two</li>
      </ul>
  </body>
  </html>
  `
    const SIZE = new BSize(400,300)
    const SCALE = 1
    let canvas = document.getElementsByTagName('canvas')[0]
    canvas.style.width = `${SIZE.w*SCALE}px`
    canvas.style.height = `${SIZE.h*SCALE}px`
    canvas.style.imageRendering = 'optimizeSpeed'
    canvas.width = SIZE.w;
    canvas.height = SIZE.h;
    let ctx =canvas.getContext('2d')
    ctx.font = '12pt sans-serif'
    ctx.imageSmoothingEnabled = false
    // console.log("input is",html1)
    let dom_tree = parse_html(html1)
    // console.log("dom tree is",dom_tree)
    let css_strings = extract_styles(dom_tree)
    let styles = parse_styles(css_strings)
    let layout_tree = layout(dom_tree,styles,canvas)
    render(layout_tree,canvas)


    canvas.addEventListener('mousedown',e => {
        let rect = e.target.getBoundingClientRect()
        let pt = new BPoint(e.clientX,e.clientY).subtract(new BPoint(rect.x,rect.y)).scale(1/SCALE)
        let elem = find_element(layout_tree,pt)
        if(elem && elem.name === 'a') {
            console.log("clicked on a link", elem.atts['href'])
        }
    })
</script>
</body>
</html>
